# DDL



## 1. 데이터 유형

![2-1](image/2-1.jpg)



## 2. CREATE TABLE



### 가. CREATE TABLE

테이블을 생성하는 구문 형식은 다음과 같다.

```sql
CREATE　TABLE　테이블이름 ( 
    칼럼명1 DATATYPE [DEFAULT 형식], 
    칼럼명2 DATATYPE [DEFAULT 형식], 
    칼럼명2 DATATYPE [DEFAULT 형식].
    CONSTRAINT 제약조건명 제약조건(컬럼명)) ;
```



다음은 테이블 생성 시에 주의해야 할 몇 가지 규칙이다.

-  테이블명은 객체를 의미할 수 있는 적절한 이름을 사용한다. 가능한 단수형을 권고한다. 

- 테이블 명은 다른 테이블의 이름과 중복되지 않아야 한다. 
- 한 테이블 내에서는 칼럼명이 중복되게 지정될 수 없다. 
  
  - 한 테이블 안에서 칼럼 이름은 달라야 하지만, 다른 테이블의 칼럼 이름과는 같을 수 있다. 같은 이름을 가진 칼럼들은 기본키와 외래키의 관계를 가지는 경우가 많으며, 향후 테이블 간의 조인 조건으로 주로 사용되는 중요한 연결고리 칼럼들이다.
- 칼럼에 대해서는 다른 테이블까지 고려하여 데이터베이스 내에서는 일관성 있게 사용하는 것이 좋다.(데이터 표준화 관점) 
- 칼럼 뒤에 데이터 유형은 꼭 지정되어야 한다. 
- 테이블명과 칼럼명은 반드시 문자로 시작해야 하고, 벤더별로 길이에 대한 한계가 있다. 
- 벤더에서 사전에 정의한 예약어(Reserved word)는 쓸 수 없다. 
- A-Z, a-z, 0-9, _, $, # 문자만 허용된다. 

- 테이블 생성시 대/소문자 구분은 하지 않는다. 기본적으로 테이블이나 칼럼명은 대문자로 만들어진다. 
- DATETIME 데이터 유형에는 별도로 크기를 지정하지 않는다. 

- 문자 데이터 유형은 반드시 가질 수 있는 최대 길이를 표시해야 한다.

- 칼럼에 대한 제약조건이 있으면 CONSTRAINT를 이용하여 추가할 수 있다.

  ```sql
  CREATE　TABLE　테이블이름 ( 
      칼럼명1 DATATYPE [DEFAULT 형식], 
      칼럼명2 DATATYPE [DEFAULT 형식], 
      칼럼명2 DATATYPE [DEFAULT 형식].
      CONSTRAINT 제약조건명 제약조건(컬럼명)) ;
  ```

  



### 나. 제약조건(CONSTRAINT)

제약조건(CONSTRAINT)이란 사용자가 원하는 조건의 데이터만 유지하기 위한 즉, 데이터의 무결성을 유지하기 위한 데이터베이스의 보편적인 방법으로 테이블의 특정 칼럼에 설정하는 제약이다. 테이블을 생성할 때 제약조건을 반드시 기술할 필요는 없지만, 이후에 ALTER TABLE을 이용해서 추가, 수정하는 경우 데이터가 이미 입력된 경우라면 처리 과정이 쉽지 않으므로 초기 테이블 생성 시점부터 적합한 제약 조건에 대한 충분한 검토가 있어야 한다.



- 제약조건의 종류

![2-5](image/2-5.jpg)

- NULL 의미

NULL은 공백이나 숫자 0과는 전혀 다른 값이며, 조건에 맞는 데이터가 없을 때의 공집합과도 다르다. ‘NULL’은 ‘아직 정의되지 않은 미지의 값’이거나 ‘현재 데이터를 입력하지 못하는 경우’를 의미한다.



- DEFAULT 의미

데이터 기본값(DEFAULT)을 사전에 설정할 수 있다. 데이터 입력시 명시된 값을 지정하지 않은 경우에 NULL 값이 입력되고, DEFAULT 값을 정의했다면 해당 칼럼에 NULL 값이 입력되지 않고 사전에 정의된 기본 값이 자동으로 입력된다.



### 다. SELECT 문장을 통한 테이블 생성 사례

다음 절에서 배울 DML 문장 중에 SELECT 문장을 활용해서 테이블을 생성할 수 있는 방법(CTAS: Create Table ~ As Select ~)이 있다. 기존 테이블을 이용한 CTAS 방법을 이용할 수 있다면 칼럼별로 데이터 유형을 다시 재정의 하지 않아도 되는 장점이 있다. 그러나 CTAS 기법 사용시 주의할 점은 기존 테이블의 제약조건 중에 NOT NULL만 새로운 복제 테이블에 적용이 되고, 기본키, 고유키, 외래키, CHECK 등의 다른 제약 조건은 없어진다는 점이다. 제약 조건을 추가하기 위해서는 뒤에 나오는 ALTER TABLE 기능을 사용해야 한다. 

```sql
CREATE TABLE 테이블명 AS SELECT * FROM 기존 테이블; 
```



## 3. ALTER TABLE



### 가. ADD COLUMN

다음은 기존 테이블에 필요한 칼럼을 추가하는 명령이다.

```sql
ALTER TABLE 테이블명 ADD(추가할 칼럼명 DATATYPE);
```



### 나. DROP COLUMN

DROP COLUMN은 테이블에서 필요 없는 칼럼을 삭제할 수 있으며, 데이터가 있거나 없거나 모두 삭제 가능하다. 한 번에 하나의 칼럼만 삭제 가능하며, 칼럼 삭제 후 최소 하나 이상의 칼럼이 테이블에 존재해야 한다. 주의할 부분은 한 번 삭제된 칼럼은 복구가 불가능하다. 다음은 테이블의 불필요한 칼럼을 삭제하는 명령이다.

```sql
ALTER TABLE 테이블명 DROP COLUMN 삭제할 칼럼명;
```



### 다. MODIFY COLUMN

테이블에 존재하는 칼럼에 대해서 ALTER TABLE 명령을 이용해 칼럼의 데이터 유형, 디폴트(DEFAULT) 값, NOT NULL 제약조건에 대한 변경을 포함할 수 있다. 다음은 테이블의 칼럼에 대한 정의를 변경하는 명령이다.

```sql
ALTER TABLE 테이블명 MODIFY(
    칼럼명1 데이터 유형 [DEFAULT 식] [NOT NULL], 
    칼럼명2 데이터 유형);
```



칼럼을 변경할 때는 몇 가지 사항을 고려해서 변경해야 한다.

- 해당 칼럼의 크기를 늘릴 수는 있지만 줄이지는 못한다. 이는 기존의 데이터가 훼손될 수 있기 때문이다. 

- 해당 칼럼이 NULL 값만 가지고 있거나 테이블에 아무 행도 없으면 칼럼의 폭을 줄일 수 있다. 

- 해당 칼럼이 NULL 값만을 가지고 있으면 데이터 유형을 변경할 수 있다. 
- 해당 칼럼의 DEFAULT 값을 바꾸면 변경 작업 이후 발생하는 행 삽입에만 영향을 미치게 된다. 
- 해당 칼럼에 NULL 값이 없을 경우에만 NOT NULL 제약조건을 추가할 수 있다.



- RENAME COLUMN

아래는 테이블을 생성하면서 만들어졌던 칼럼명을 어떤 이유로 불가피하게 변경해야 하는 경우에 유용하게 쓰일 수 있는 RENAME COLUMN 문구이다.

```sql
ALTER TABLE 테이블명 RENAME COLUMN 변경해야 할 칼럼명 TO 새로운 칼럼명;
```

RENAME COLUMN으로 칼럼명이 변경되면, 해당 칼럼과 관계된 제약조건에 대해서도 자동으로 변경되는 장점이 있다. Oracle 등 일부 DBMS에서만 지원하는 기능이다.



### 라. DROP CONSTRAINT

테이블 생성 시 부여했던 제약조건을 삭제하는 명령어 형태는 다음과 같다.

```sql
ALTER TABLE 테이블명 DROP CONSTRAINT 제약조건명;
```



### 마. ADD CONSTRAINT

테이블 생성 시 제약조건을 적용하지 않았다면, 생성 이후에 필요에 의해서 제약조건을 추가할 수 있다. 다음은 특정 칼럼에 제약조건을 추가하는 명령어 형태이다.

```sql
ALTER TABLE 테이블명 ADD CONSTRAINT 제약조건명 제약조건(칼럼명);
```



ALTER TABLE 테이블명 ADD CONSTRAINT 제약조건명 제약조건 (칼럼명);



[예제] Oracle ALTER TABLE PLAYER ADD CONSTRAINT PLAYER_FK FOREIGN KEY (TEAM_ID) **REFERENCES** TEAM(TEAM_ID); 테이블이 변경되었다.

위와 같이 참조 제약조건(REFERENCES)을 추가하면 PLAYER 테이블의 TEAM_ID 칼럼이 TEAM 테이블의 TEAM_ID 칼럼을 참조하게 된다. 참조 무결성 옵션에 따라서 만약 TEAM 테이블이나 TEAM 테이블의 데이터를 삭제하려 할 경우 외부(PLAYER 테이블)에서 참조되고 있기 때문에 삭제가 불가능하게 제약을 할 수 있다. 즉, 외부키(FK)를 설정함으로써 실수에 의한 테이블 삭제나 필요한 데이터의 의도하지 않은 삭제와 같은 불상사를 방지하는 효과를 볼 수 있다.



## 4. RENAME TABLE

RENAME 명령어를 사용하여 테이블의 이름을 변경할 수 있다.

```sql
RENAME 변경전 테이블명 TO 변경후 테이블명;
```



## 5. DROP TABLE

테이블을 잘못 만들었거나 테이블이 더 이상 필요 없을 경우 해당 테이블을 삭제해야 한다. 다음은 불필요한 테이블을 삭제하는 명령이다.

```sql
DROP TABLE 테이블명 [CASCADE CONSTRAINT];
```

DROP 명령어를 사용하면 테이블의 모든 데이터 및 구조를 삭제한다. CASCADE CONSTRAINT 옵션은 해당 테이블과 관계가 있었던 참조되는 제약조건에 대해서도 삭제한다는 것을 의미한다. SQL Server에서는 CASCADE 옵션이 존재하지 않으며 테이블을 삭제하기 전에 참조하는 FOREIGN KEY 제약 조건 또는 참조하는 테이블을 먼저 삭제해야 한다.



## 6. TRUNCATE TABLE

TRUNCATE TABLE은 테이블 자체가 삭제되는 것이 아니고, 해당 테이블에 들어있던 모든 행들이 제거되고 저장 공간을 재사용 가능하도록 해제한다. 테이블 구조를 완전히 삭제하기 위해서는 DROP TABLE을 실행하면 된다.

```sql
TRUNCATE TABLE PLAYER;
```

테이블의 전체 데이터를 삭제하는 경우, 시스템 활용 측면에서는 DELETE TABLE 보다는 시스템 부하가 적은 TRUNCATE TABLE을 권고한다. 단, TRUNCATE TABLE의 경우 정상적인 복구가 불가능하므로 주의해야 한다.

|         DROP         |             TRUNCATE             |              DELETE              |
| :------------------: | :------------------------------: | :------------------------------: |
|         DDL          |               DDL                |               DML                |
|   Rollback 불가능    |         Rollback 불가능          |          Rollback 가능           |
|     Auto Commit      |           Auto Commit            |          사용자 Commit           |
| 테이블의 정의를 삭제 | 테이블 구조는 남기고 데이터 삭제 | 테이블 구조는 남기고 데이터 삭제 |

